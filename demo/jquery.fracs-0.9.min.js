(function(e){var b=function(n,m,l,k){var j=undefined;this.left=Math.round(n);this.top=Math.round(m);this.width=Math.round(l);this.height=Math.round(k);this.right=this.left+this.width;this.bottom=this.top+this.height;this.equals=function(o){return this.left===o.left&&this.top===o.top&&this.width===o.width&&this.height===o.height};this.area=function(){return this.width*this.height};this.intersection=function(s){var u=Math.max(this.left,s.left);var q=Math.min(this.right,s.right);var t=Math.max(this.top,s.top);var p=Math.min(this.bottom,s.bottom);var r=q-u;var o=p-t;if(r<0||o<0){return undefined}return new b(u,t,r,o)};this.envelope=function(s){var u=Math.min(this.left,s.left);var q=Math.max(this.right,s.right);var t=Math.min(this.top,s.top);var p=Math.max(this.bottom,s.bottom);var r=q-u;var o=p-t;return new b(u,t,r,o)};this.bind=function(o){if(j===undefined){j=new g(this);e(window).bind("scroll",j.check).bind("resize",j.check)}j.bind(o)},this.unbind=function(o){if(j!==undefined){j.unbind(o);if(j.callbacks.length===0){e(window).unbind("scroll",j.check).unbind("resize",j.check);j=undefined}}};this.check=function(){if(j){j.check()}};this.fracs=function(){e.fracs.fracs(this)}};var d=function(n,k,m,o,j,l){this.rects=n===undefined?undefined:{document:n,element:k,viewport:m};this.visible=o||0;this.viewport=j||0;this.possible=l||0;this.equals=function(p){return this.fracsEqual(p)&&this.rectsEqual(p)};this.fracsEqual=function(p){return this.visible===p.visible&&this.viewport===p.viewport&&this.possible===p.possible};this.rectsEqual=function(p){if(this.rects===undefined||p.rects===undefined){return this.rects===p.rects}return this.rects.document.equals(p.rects.document)&&this.rects.element.equals(p.rects.element)&&this.rects.viewport.equals(p.rects.viewport)}};var i=function(){var l=e.fracs.document();var k=e.fracs.viewport();var m=l.width-k.width;var j=l.height-k.height;this.width=m<=0?undefined:k.left/m;this.height=j<=0?undefined:k.top/j;this.left=k.left;this.top=k.top;this.right=l.right-k.right;this.bottom=l.bottom-k.bottom;this.equals=function(n){return this.width===n.width&&this.height===n.height&&this.left===n.left&&this.top===n.top&&this.right===n.right&&this.bottom===n.bottom}};var h=function(){this.prevState=new i();this.callbacks=[];e(window).bind("resize scroll load",e.proxy(function(){var j=new i();if(!this.prevState.equals(j)){e.each(this.callbacks,e.proxy(function(k,l){l.call(window,j,this.prevState)},this));this.prevState=j}},this))};var a=function(k,j){this.element=k;this.fracs=j;this.update=function(){var l=e.fracs.fracs(this.element);var m=this.fracs===undefined||!this.fracs.equals(l);this.fracs=l;return m}};var g=function(j){this.target=j;this.callbacks=[];this.prevFracs=undefined;this.bind=function(k){if(k!==undefined&&e.inArray(k,this.callbacks)===-1){this.callbacks.push(k)}};this.unbind=function(l){if(l===undefined){this.callbacks=[]}else{var k=e.inArray(l,this.callbacks);if(k>=0){this.callbacks.splice(k,1)}}};this.check=e.proxy(function(){var k=this.target instanceof HTMLElement?e.fracs.rect(this.target):this.target;var l=e.fracs.fracs(k,e.fracs.viewport());if(this.prevFracs===undefined||!this.prevFracs.equals(l)){e.each(this.callbacks,e.proxy(function(m,n){n.call(this.target,l,this.prevFracs)},this));this.prevFracs=l}},this)};var c=function(k,l,n){this.targets=[];this.callback=n;this.prevBest=undefined;this.property=l;for(var j in k){var m=k[j];if(m instanceof HTMLElement){this.targets.push(new a(m))}}this.check=e.proxy(function(){var r=undefined;var p=e.fracs.viewport();for(var o in this.targets){var q=this.targets[o];q.update();if(r===undefined||q.fracs[this.property]>r.fracs[this.property]){r=q}}if(r.fracs[this.property]==0){r=undefined}if(this.prevBest!==r){this.callback.call(this,r,this.prevBest);this.prevBest=r}},this)};e.fracs=function(){return e.fracs.fracs.apply(this,arguments)};e.fracs.internal={dataNs:"fracs",methods:{},objects:{}};e.fn.fracs=function(k){var j=e.fracs.internal.methods;if(j[k]){return j[k].apply(this,Array.prototype.slice.call(arguments,1))}else{if(k===undefined){return j.fracs.apply(this,arguments)}else{if(k instanceof Function){return j.bind.apply(this,arguments)}else{e.error("Method "+k+" does not exist on jQuery.fracs")}}}};e.extend(e.fracs,{document:function(){var j=e(document);return new b(0,0,j.width(),j.height())},viewport:function(){var j=e(window);return new b(j.scrollLeft(),j.scrollTop(),j.width(),j.height())},rect:function(k){var j=e(k);var l=j.offset();return new b(l.left,l.top,j.outerWidth(),j.outerHeight())},fracs:function(o,l){o=o instanceof HTMLElement?e.fracs.rect(o):o;l=l||e.fracs.viewport();var p=o.intersection(l);if(p===undefined){return new d()}var n=new b(p.left-o.left,p.top-o.top,p.width,p.height);var k=new b(p.left-l.left,p.top-l.top,p.width,p.height);var j=p.area();var m=Math.min(o.width,l.width)*Math.min(o.height,l.height);return new d(p,n,k,j/o.area(),j/l.area(),j/m)},round:function(k,j){if(isNaN(j)||j<=0){return Math.round(k)}return Math.round(k*Math.pow(10,j))/Math.pow(10,j)},scrollTo:function(l,k,j){j=j!==undefined?j:1000;e("html,body").stop(true).animate({scrollLeft:l,scrollTop:k},j)},scroll:function(l,k,j){j=j!==undefined?j:1000;var m=e(window);e("html,body").stop(true).animate({scrollLeft:m.scrollLeft()+l,scrollTop:m.scrollTop()+k},j)},scrollState:function(j){if(j instanceof Function){f.callbacks.push(j)}else{return new i()}}});e.extend(e.fracs.internal.methods,{bind:function(j){return this.each(function(){var l=e(this);var k=l.data(e.fracs.internal.dataNs);if(k===undefined){k=new g(this);l.data(e.fracs.internal.dataNs,k);e(window).bind("scroll resize",k.check)}k.bind(j)})},unbind:function(j){return this.each(function(){var l=e(this);var k=l.data(e.fracs.internal.dataNs);if(k!==undefined){k.unbind(j);if(k.callbacks.length===0){l.removeData(e.fracs.internal.dataNs);e(window).unbind("scroll resize",k.check)}}})},check:function(){return this.each(function(){var j=e(this).data(e.fracs.internal.dataNs);if(j){j.check()}})},fracs:function(){return e.fracs.fracs(e.fracs.rect(this.get(0)),e.fracs.viewport())},rect:function(){return e.fracs.rect(this.get(0))},max:function(l,o){if(o instanceof Function){var k=new c(this,l,o);e(window).bind("scroll resize",k.check);k.check();return this}else{var n=undefined;if(e.inArray(l,["possible","visible","viewport"])>=0){n="fracs"}else{if(e.inArray(l,["width","height","left","right","top","bottom"])>=0){n="rect"}else{return this}}var j=[];var m=undefined;this.each(function(){var p=e.fracs[n](this);if(m===undefined||p[l]>m){j=[this];m=p[l]}else{if(p[l]===m){j.push(this)}}});return e(j)}},min:function(l){var m=undefined;if(e.inArray(l,["possible","visible","viewport"])>=0){m="fracs"}else{if(e.inArray(l,["width","height","left","right","top","bottom"])>=0){m="rect"}else{return this}}var k=[];var j=undefined;this.each(function(){var n=e.fracs[m](this);if(j===undefined||n[l]<j){k=[this];j=n[l]}else{if(n[l]===j){k.push(this)}}});return e(k)},envelope:function(){var j=undefined;this.each(function(){var k=e.fracs.rect(this);j=j===undefined?k:j.envelope(k)});return j},scrollTo:function(j,l,m){j=j||0;l=l||0;var k=e.fracs.rect(this.get(0));e.fracs.scrollTo(k.left-j,k.top-l,m);return this},softLink:function(j,k,l){return this.filter("a[href^=#]").each(function(){var n=e(this);var m=n.attr("href");n.click(function(){e(m).fracs("scrollTo",j,k,l)})})}});e.extend(e.fracs.internal.objects,{Rect:b,FracsResult:d,ScrollState:i,ScrollStateTracker:h,FracsElement:a,FracsData:g,FracsGroup:c});var f=new h()})(jQuery);(function(b){var a=function(d,c){if(!(d instanceof HTMLElement)||d.nodeName.toLowerCase()!=="canvas"){return undefined}var f={crop:false,duration:100,focusWidth:0.5,focusHeight:0.5,styles:[{selector:"header,footer,section,article",fillStyle:"rgb(230,230,230)"},{selector:"h1",fillStyle:"rgb(240,140,060)"},{selector:"h2",fillStyle:"rgb(200,100,100)"},{selector:"h3",fillStyle:"rgb(100,200,100)"},{selector:"h4",fillStyle:"rgb(100,100,200)"}],viewportStyle:{fillStyle:"rgba(228,77,38,0.3)"},viewportDragStyle:{fillStyle:"rgba(228,77,38,0.6)"},invertViewport:false};this.settings=b.extend({},f,c);this.context=d.getContext("2d");this.$canvas=b(d);this.width=this.$canvas.attr("width");this.height=this.$canvas.attr("height");this.$window=b(window);this.$htmlBody=b("html,body");this.docRect;this.vpRect;this.scale;this.drag=false;var e=this;this.init=function(){var g=b.proxy(this.scroll,this);this.$canvas.css("cursor","pointer").mousedown(b.proxy(function(h){h.preventDefault();this.drag=true;this.scroll(h);this.$canvas.css("cursor","crosshair").addClass("dragOn");this.$htmlBody.css("cursor","crosshair");this.$window.bind("mousemove",g).one("mouseup",b.proxy(function(i){i.preventDefault();this.$canvas.css("cursor","pointer").removeClass("dragOn");this.$htmlBody.css("cursor","auto");this.$window.unbind("mousemove",g);this.drag=false;this.draw()},this))},this));d.onselectstart=function(){return false};this.$window.bind("load resize scroll",b.proxy(this.draw,this));this.draw()};this.applyStyles=function(g){for(idx in this.settings.styles){var h=this.settings.styles[idx];b(h.selector).each(function(){e.drawElement(g,this,h.strokeWidth,h.strokeStyle,h.fillStyle)})}};this.drawElement=function(i,k,m,l,h){var g=b(k);var j=g.fracs("rect");m=m==="auto"?g.css("border-width"):m;l=l==="auto"?g.css("border-color"):l;h=h==="auto"?g.css("background-color"):h;this.drawRect(i,j,m,l,h)};this.drawRect=function(i,j,g,l,h,k){k=k||false;if(g!==undefined&&this.scale!==undefined){g=g>0.2/this.scale?g:0.2/this.scale}if(l!==undefined||h!==undefined){if(k===false){i.beginPath();i.rect(j.left,j.top,j.width,j.height);if(h!==undefined){i.fillStyle=h;i.fill()}if(l!==undefined){i.lineWidth=g;i.strokeStyle=l;i.stroke()}}else{if(h!==undefined){i.beginPath();i.rect(0,0,this.docRect.width,j.top);i.rect(0,j.top,j.left,j.height);i.rect(j.right,j.top,this.docRect.right-j.right,j.height);i.rect(0,j.bottom,this.docRect.width,this.docRect.bottom-j.bottom);i.fillStyle=h;i.fill()}if(l!==undefined){i.beginPath();i.rect(j.left,j.top,j.width,j.height);i.lineWidth=g;i.strokeStyle=l;i.stroke()}}}};this.drawViewport=function(){if(this.drag===true&&this.settings.viewportDragStyle!==undefined){var g=this.settings.viewportDragStyle.storkeWidth;var i=this.settings.viewportDragStyle.strokeStyle;var h=this.settings.viewportDragStyle.fillStyle}else{var g=this.settings.viewportStyle.storkeWidth;var i=this.settings.viewportStyle.strokeStyle;var h=this.settings.viewportStyle.fillStyle}this.drawRect(this.context,this.vpRect,g,i,h,this.settings.invertViewport)};this.draw=function(){this.docRect=b.fracs.document();this.vpRect=b.fracs.viewport();var h=this.width/this.docRect.width;var g=this.height/this.docRect.height;this.scale=h<g?h:g;if(this.settings.crop){this.$canvas.attr("width",this.docRect.width*this.scale).attr("height",this.docRect.height*this.scale)}this.context.clearRect(0,0,this.$canvas.width(),this.$canvas.height());this.context.scale(this.scale,this.scale);this.applyStyles(this.context);this.drawViewport();this.context.scale(1/this.scale,1/this.scale)};this.scroll=function(i){var h=this.$canvas.fracs("rect");var g=i.pageX-h.left;var j=i.pageY-h.top;b.fracs.scrollTo(g/this.scale-this.vpRect.width*this.settings.focusWidth,j/this.scale-this.vpRect.height*this.settings.focusHeight,this.settings.duration)};this.init()};b.extend(b.fracs,{});b.extend(b.fracs.internal.methods,{outline:function(c){return this.each(function(){if(c==="redraw"){var d=b(this).data("outline");if(d!==undefined){d.draw()}}else{var d=new a(this,c);if(d!==undefined){b(this).data("outline",d)}}})}});b.extend(b.fracs.internal.objects,{Outline:a})})(jQuery);